<div *ngIf="!mostrarImagenes">
  <div class="p-4 h-[calc(100vh-150px)] flex flex-col">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-bold">Logística</h2>
      <div class="flex items-center">
        <button 
          type="button" 
          mat-flat-button 
          color="accent" 
          class="flex items-center mr-2"
          (click)="mostrarImagenes = true"
        >
          <mat-icon class="mr-1">image</mat-icon>
          Ver imágenes
        </button>
        <button type="button" mat-flat-button color="primary" (click)="abrirDialogoCrear()" class="flex items-center">
          <mat-icon class="mr-1">add</mat-icon>
          Agregar Item
        </button>
      </div>
    </div>

    <div class="relative w-full mb-4">
      <span class="absolute inset-y-0 left-0 flex items-center pl-3">
        <mat-icon class="text-gray-500">search</mat-icon>
      </span>
      <input
        type="text"
        [(ngModel)]="busqueda"
        placeholder="{{ tipoSeleccionado?.toLowerCase() === 'transporte' ? 'Buscar Vehículos por Nombre' : 'Buscar Elementos por Nombre' }}"
        class="pl-10 pr-4 py-2 text-black border rounded-md w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
      />
      <button
        *ngIf="busqueda"
        type="button"
        (click)="limpiarBusqueda()"
        class="absolute inset-y-0 right-0 flex items-center pr-3"
        aria-label="Limpiar búsqueda"
      >
        <mat-icon class="text-gray-500">close</mat-icon>
      </button>
    </div>

    <div *ngIf="tipoSeleccionado?.toLowerCase() === 'transporte'" class="overflow-y-auto flex-1">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div 
          *ngFor="let vehiculo of inventarioFiltrado" 
          class="bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden hover:shadow-xl transition-shadow duration-300"
        >
          <div class="bg-gradient-to-r from-green-700 to-green-200 h-14 flex items-center justify-center relative">
            <mat-icon >local_shipping</mat-icon>
          </div>
          <div class="p-4">
            <div class="mb-3">
              <h3 class="text-xl font-bold text-gray-800 mb-1">{{ vehiculo.nombre }}</h3>
            </div>

            <div class="space-y-2 mb-4">
              <div class="flex justify-between items-center py-1 border-b border-gray-100">
                <span class="text-sm text-gray-600">Total:</span>
                <span class="font-semibold text-gray-800">{{ vehiculo.cantidad_total }}</span>
              </div>
              <div class="flex justify-between items-center py-1 border-b border-gray-100">
                <span class="text-sm text-gray-600">Desplegado:</span>
                <span class="font-semibold text-orange-600">{{ vehiculo.cantidad_uso }}</span>
              </div>
              <div class="flex justify-between items-center py-1 border-b border-gray-100">
                <span class="text-sm text-gray-600">Disponible:</span>
                <span 
                  class="font-semibold"
                  [ngClass]="{
                    'text-green-600': vehiculo.cantidad_total - vehiculo.cantidad_uso > 0,
                    'text-red-600': vehiculo.cantidad_total - vehiculo.cantidad_uso === 0
                  }"
                >
                  {{ vehiculo.cantidad_total - vehiculo.cantidad_uso }}
                </span>
              </div>
            </div>
            <div class="flex justify-between space-x-2">
              <button 
                mat-stroked-button 
                color="primary" 
                class="flex-1"
                (click)="abrirDialogoEditar(vehiculo)"
              >
                <mat-icon class="mr-1 text-sm">edit</mat-icon>
                Editar
              </button>
              <button 
                mat-stroked-button 
                color="warn" 
                class="flex-1"
                (click)="abrirDialogoEliminar(vehiculo)"
              >
                <mat-icon class="mr-1 text-sm">delete</mat-icon>
                Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="inventarioFiltrado.length === 0" class="text-center py-12">
        <mat-icon class="text-6xl text-gray-400 mb-4">local_shipping</mat-icon>
        <h3 class="text-xl font-semibold text-gray-600 mb-2">No se encontraron vehículos</h3>
        <p class="text-gray-500">{{ busqueda ? 'Intenta con otros términos de búsqueda' : 'Comienza agregando tu primer vehículo' }}</p>
      </div>
    </div>

    <div *ngIf="tipoSeleccionado?.toLowerCase() !== 'transporte'" class="overflow-y-auto flex-1 border border-gray-300 rounded-lg">
      <table mat-table [dataSource]="inventario" class="w-full mat-elevation-z2">

        <ng-container matColumnDef="nro">
          <th mat-header-cell *matHeaderCellDef class="bg-gray-100 py-2 px-4 text-left">Nro</th>
          <td mat-cell *matCellDef="let element; let i = index" class="py-2 px-4 border-t">
            {{ i + 1 }}
          </td>
        </ng-container>

        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef class="bg-gray-100 py-2 px-4 text-left">Nombre</th>
          <td mat-cell *matCellDef="let element" class="py-2 px-4 border-t">
            {{ element.nombre }}
          </td>
        </ng-container>

        <ng-container matColumnDef="cantidad_total">
          <th mat-header-cell *matHeaderCellDef class="bg-gray-100 py-2 px-4 text-left">Total</th>
          <td mat-cell *matCellDef="let element" class="py-2 px-4 border-t">
            {{ element.cantidad_total }}
          </td>
        </ng-container>

        <ng-container matColumnDef="cantidad_uso">
          <th mat-header-cell *matHeaderCellDef class="bg-gray-100 py-2 px-4 text-left">Desplegado</th>
          <td mat-cell *matCellDef="let element" class="py-2 px-4 border-t">
            {{ element.cantidad_uso }}
          </td>
        </ng-container>

        <ng-container matColumnDef="cantidad_disponible">
          <th mat-header-cell *matHeaderCellDef class="bg-gray-100 py-2 px-4 text-left">Disponible</th>
          <td mat-cell *matCellDef="let element" class="py-2 px-4 border-t">
            {{ element.cantidad_total - element.cantidad_uso }}
          </td>
        </ng-container>

        <ng-container matColumnDef="editar">
          <th mat-header-cell *matHeaderCellDef class="bg-gray-100 py-2 px-4 text-center">Editar</th>
          <td mat-cell *matCellDef="let element" class="py-2 px-4 border-t text-center">
            <button mat-icon-button color="primary" (click)="abrirDialogoEditar(element)">
              <mat-icon>edit</mat-icon>
            </button>
          </td>
        </ng-container>

        <ng-container matColumnDef="eliminar">
          <th mat-header-cell *matHeaderCellDef class="bg-gray-100 py-2 px-4 text-center">Eliminar</th>
          <td mat-cell *matCellDef="let element" class="py-2 px-4 border-t text-center">
            <button mat-icon-button color="warn" (click)="abrirDialogoEliminar(element)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="border-b"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          [class.hidden]="!coincideBusqueda(row)"
          class="hover:bg-gray-50"
        ></tr>
      </table>
    </div>
  </div>
</div>
<app-logistica-imagenes *ngIf="mostrarImagenes" (cerrar)="mostrarImagenes = false"></app-logistica-imagenes>
