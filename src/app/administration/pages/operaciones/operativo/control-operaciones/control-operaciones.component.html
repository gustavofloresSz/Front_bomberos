<div class="p-4 h-[calc(100vh-150px)] flex flex-col">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-bold">Puestos de control, vigilancia y registro (PCVR)</h2>
    <button type="button" mat-flat-button color="primary" (click)="abrirDialogoCrear()">
      <mat-icon class="mr-1">add</mat-icon>
      Agregar Control
    </button>
  </div>

  <div class="relative w-full mb-4">
    <span class="absolute inset-y-0 left-0 flex items-center pl-3">
      <mat-icon class="text-gray-500">search</mat-icon>
    </span>
    <input
      type="text"
      [(ngModel)]="busqueda"
      placeholder="Buscar"
      class="pl-10 pr-4 py-2 text-black border rounded-md w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
    />
    <button
      *ngIf="busqueda"
      type="button"
      (click)="limpiarBusqueda()"
      class="absolute inset-y-0 right-0 flex items-center pr-3"
      aria-label="Limpiar bÃºsqueda"
    >
      <mat-icon class="text-gray-500">close</mat-icon>
    </button>
  </div>

  <div class="overflow-y-auto flex-1 border border-gray-300 rounded-lg">
    <table mat-table [dataSource]="operaciones" class="w-full mat-elevation-z2">

      <ng-container matColumnDef="nro">
        <th mat-header-cell *matHeaderCellDef class="bg-gray-100 py-2 px-4 text-left">Nro</th>
        <td mat-cell *matCellDef="let element; let i = index" class="py-2 px-4 border-t">
          {{ i + 1 }}
        </td>
      </ng-container>

      <ng-container matColumnDef="fecha_inicio">
        <th mat-header-cell *matHeaderCellDef class="bg-gray-100 px-4 py-2">Fecha Inicio</th>
        <td mat-cell *matCellDef="let el" class="px-4 py-2 border-t">{{ el.fecha_inicio | date: 'dd/MM/yyyy' }}</td>
      </ng-container>

      <ng-container matColumnDef="fecha_fin">
        <th mat-header-cell *matHeaderCellDef class="bg-gray-100 px-4 py-2">Fecha Fin</th>
        <td mat-cell *matCellDef="let el" class="px-4 py-2 border-t">{{ el.fecha_fin ? (el.fecha_fin | date: 'dd/MM/yyyy') : '-' }}</td>
      </ng-container>

      <ng-container matColumnDef="responsable">
        <th mat-header-cell *matHeaderCellDef class="bg-gray-100 px-4 py-2">Responsable</th>
        <td mat-cell *matCellDef="let el" class="px-4 py-2 border-t">{{ el.responsable || '-' }}</td>
      </ng-container>

      <ng-container matColumnDef="cuadrillas">
        <th mat-header-cell *matHeaderCellDef class="bg-gray-100 px-4 py-2">Cuadrillas</th>
        <td mat-cell *matCellDef="let el" class="px-4 py-2 border-t">{{ el.cuadrillas ?? '-' }}</td>
      </ng-container>

      <ng-container matColumnDef="efectivo">
        <th mat-header-cell *matHeaderCellDef class="bg-gray-100 px-4 py-2">Efectivo</th>
        <td mat-cell *matCellDef="let el" class="px-4 py-2 border-t">{{ el.efectivo ?? '-' }}</td>
      </ng-container>

      <ng-container matColumnDef="comunidad_municipio">
        <th mat-header-cell *matHeaderCellDef class="bg-gray-100 px-4 py-2">Comunidad/Municipio</th>
        <td mat-cell *matCellDef="let el" class="px-4 py-2 border-t">{{ el.lugar || '-' }}</td>
      </ng-container>

      <ng-container matColumnDef="distancia_kms">
        <th mat-header-cell *matHeaderCellDef class="bg-gray-100 px-4 py-2">Distancia (km)</th>
        <td mat-cell *matCellDef="let el" class="px-4 py-2 border-t">{{ el.distancia_kms ?? '-' }}</td>
      </ng-container>

      <ng-container matColumnDef="material_equipo">
        <th mat-header-cell *matHeaderCellDef class="bg-gray-100 px-4 py-2">Material/Equipo</th>
        <td mat-cell *matCellDef="let el" class="px-4 py-2 border-t">{{ el.material_equipo || '-' }}</td>
      </ng-container>

      <ng-container matColumnDef="novedades">
        <th mat-header-cell *matHeaderCellDef class="bg-gray-100 px-4 py-2">Novedades</th>
        <td mat-cell *matCellDef="let el" class="px-4 py-2 border-t">{{ el.novedades || '-' }}</td>
      </ng-container>

      <ng-container matColumnDef="editar">
        <th mat-header-cell *matHeaderCellDef class="bg-gray-100 py-2 px-4 text-center">Editar</th>
        <td mat-cell *matCellDef="let el" class="py-2 px-4 border-t text-center">
          <button mat-icon-button color="primary" (click)="abrirDialogoEditar(el)">
            <mat-icon>edit</mat-icon>
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="eliminar">
        <th mat-header-cell *matHeaderCellDef class="bg-gray-100 py-2 px-4 text-center">Eliminar</th>
        <td mat-cell *matCellDef="let el" class="py-2 px-4 border-t text-center">
          <button mat-icon-button color="warn" (click)="abrirDialogoEliminar(el)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns" class="border-b"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        [class.hidden]="!coincideBusqueda(row)"
        class="hover:bg-gray-50"
      ></tr>
    </table>
  </div>
</div>
