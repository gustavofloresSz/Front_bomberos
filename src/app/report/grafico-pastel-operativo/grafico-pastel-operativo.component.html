<div class="text-center text-2xl font-bold text-white mb-2">
  Gráfico Operaciones
</div>

<div class="w-[530px] mx-auto p-1">
  <div class="flex flex-col md:flex-row gap-4 mb-4">
    <div class="flex-1">
      <mat-form-field appearance="fill" class="w-full">
        <mat-label class="text-black">Selecciona un lugar</mat-label>
        <mat-select
          [(value)]="lugarSeleccionado"
          (selectionChange)="onLugarSeleccionado($event.value)"
          (openedChange)="onLugarOpened($event)"
        >
          <mat-option>
            <input
              matInput
              placeholder="Buscar lugar..."
              [(ngModel)]="filtroLugar"
              (click)="$event.stopPropagation()"
              class="w-full px-2 py-1 border border-blue-900 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </mat-option>
          <mat-option *ngFor="let lugar of lugaresFiltrados" [value]="lugar">
            {{ lugar }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="flex-1">
      <mat-form-field appearance="fill" class="w-full">
        <mat-label class="text-black">Selecciona un tipo</mat-label>
        <mat-select
          [(ngModel)]="tipoSeleccionado"
          [disabled]="!lugarSeleccionado"
          (selectionChange)="onTipoSeleccionado($event.value)"
          (openedChange)="onTipoOpened($event)"
        >
          <mat-option>
            <input
              type="text"
              [(ngModel)]="filtroTipo"
              placeholder="Buscar tipo..."
              (click)="$event.stopPropagation()"
              class="w-full px-2 py-1 border border-blue-900 rounded focus:outline-none 
                     focus:ring-2 focus:ring-blue-500"
            />
          </mat-option>

          <mat-option *ngFor="let tipo of tiposFiltrados" [value]="tipo">
            {{ tipo }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

  </div>

  <div *ngIf="chartData.labels?.length" class="w-[400px] mx-auto p-4">
    <canvas baseChart
            [data]="chartData"
            [type]="pieChartType"
            [options]="chartOptions">
    </canvas>
  </div>

  <div *ngIf="!chartData.labels?.length && lugarSeleccionado && tipoSeleccionado" class="text-yellow-400 text-center mt-4">
    No hay datos disponibles para la selección actual.
  </div>
</div>